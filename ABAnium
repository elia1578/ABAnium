-- ABA Auto Farm Script Hub
-- Simplified Hardcoded Version

-- Load Rayfield UI Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create Window
local Window = Rayfield:CreateWindow({
    Name = "ABAnium",
    LoadingTitle = "Loading ABA Auto Farm...",
    LoadingSubtitle = "by Sigma :)",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "ABAAutoFarm",
        FileName = "Config"
    },
    Discord = {
        Enabled = false,
        Invite = "noinvitelink",
        RememberJoins = true
    },
    KeySystem = false,
})

-- Create Main Tab
local MainTab = Window:CreateTab("Auto Farm", 4483362458)

-- Toggles Section
local MainSection = MainTab:CreateSection("Farm Mode Selection")

local FarmEnabled = false
local FarmMode = "Main" -- "Main" or "Alt"
local SelectedCharacter = "None"

local VirtualUser = game:GetService('VirtualUser')
game:GetService('Players').LocalPlayer.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- Create Main Toggle
local MainToggle = MainTab:CreateToggle({
    Name = "Main Account Mode",
    CurrentValue = false,
    Flag = "MainMode",
    Callback = function(Value)
        if Value then
            setfpscap(20)
            FarmEnabled = true
            FarmMode = "Main"
            print("[START] Main Farm Enabled")
        else
            setfpscap(200)
            FarmEnabled = false
            print("[STOP] Main Farm Disabled")
        end
    end,
})

-- Create Alt Toggle
local AltToggle = MainTab:CreateToggle({
    Name = "Alt Account Mode",
    CurrentValue = false,
    Flag = "AltMode",
    Callback = function(Value)
        if Value then
            setfpscap(20)
            FarmEnabled = true
            FarmMode = "Alt"
            print("[START] Alt Farm Enabled")
        else
            setfpscap(200)
            FarmEnabled = false
            print("[STOP] Alt Farm Disabled")
        end
    end,
})

MainTab:CreateButton({
    Name = "Lower Quality",
    Callback = function()
        local Lighting = game:GetService("Lighting")
        local Terrain = workspace:FindFirstChildOfClass("Terrain")
        
        settings().Rendering.QualityLevel = 1
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 9e9
        
        if Terrain then
            Terrain.WaterWaveSize = 0
            Terrain.WaterWaveSpeed = 0
            Terrain.WaterReflectance = 0
            Terrain.WaterTransparency = 0
        end

        task.spawn(function()
            for _, v in ipairs(workspace:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.Material = Enum.Material.SmoothPlastic
                    v.Reflectance = 0
                elseif v:IsA("Decal") or v:IsA("Texture") then
                    v.Transparency = 1
                elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
                    v.Enabled = false
                elseif v:IsA("PostEffect") then
                    v.Enabled = false
                end
            end
            
            Rayfield:Notify({
                Title = "Quality Lowered",
                Content = "Textures and effects have been optimized.",
                Duration = 3
            })
        end)
    end,
})

-- Status Section
local StatusSection = MainTab:CreateSection("Status")
local StatusLabel = MainTab:CreateLabel("Status: Disabled")

-- Get services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- Import the firesignal function from the working example
local function Firesignal(signal, ...)
    for _, connection in pairs(getconnections(signal)) do
        connection:Fire(...)
    end
end

-- Function to press any button
local function PressButton(button)
    if not button then return false end
    
    -- Try all possible methods
    if button.Activated then
        Firesignal(button.Activated, LocalPlayer)
        print("[CLICK] Activated:", button.Name)
        return true
    elseif button.MouseButton1Click then
        Firesignal(button.MouseButton1Click)
        print("[CLICK] MouseButton1Click:", button.Name)
        return true
    elseif button:IsA("TextButton") or button:IsA("ImageButton") then
        button:Fire("Click")
        print("[CLICK] Fire Click:", button.Name)
        return true
    end
    
    return false
end

-- CONSTANT CHECK LOOP
spawn(function()
    while true do
        if FarmEnabled then
            -- Get current PlayerGui
            local PlayerGui = LocalPlayer.PlayerGui
            
            -- PHASE 1: Check for Rematch Button
            local Rematch = PlayerGui:FindFirstChild("Rematch")
            if Rematch then
                local TextButton = Rematch:FindFirstChild("TextButton")
                if TextButton and TextButton.Visible then
                    StatusLabel:Set("Phase: Rematch")
                    print("[PHASE] Rematch detected")
                    PressButton(TextButton)
                    wait(0.5)
                end
            end
            
            -- PHASE 2: Check for Map Ban
            local MapBan = PlayerGui:FindFirstChild("MapBan")
            if MapBan and MapBan.Frame.Visible then
                StatusLabel:Set("Phase: Map Ban")
                print("[PHASE] Map Ban detected")
                
                -- Try to find and click map buttons
                local MapsFrame = MapBan:FindFirstChild("Frame")
                if MapsFrame then
                    MapsFrame = MapsFrame:FindFirstChild("Maps")
                    if MapsFrame then
                        local Map1 = MapsFrame:FindFirstChild("Map1")
                        local Map2 = MapsFrame:FindFirstChild("Map2")
                        local Map3 = MapsFrame:FindFirstChild("Map3")
                        
                        PressButton(Map1)
                        wait(0.4)
                        PressButton(Map2)
                        wait(0.4)
                        PressButton(Map3)
                    end
                end
                wait(0.5)
            end
            
            -- PHASE 3: Check for Character Ban
            local BanChooser = PlayerGui:FindFirstChild("BanChooser")
            if BanChooser and BanChooser.CharacterSelect.Visible then
                StatusLabel:Set("Phase: Character Ban")
                print("[PHASE] Character Ban detected")
                
                local CharacterSelect = BanChooser:FindFirstChild("CharacterSelect")
                if CharacterSelect then
                    local PassBan = CharacterSelect:FindFirstChild("Pass Ban")
                    if PassBan then
                        PressButton(PassBan)
                    else
                        print("[ERROR] Pass Ban button not found")
                    end
                end
                wait(0.5)
            end

            -- PHASE 4: Check for Fight Phase (Health UI visible)
            if game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("HUD") then
                local HealthUI = game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("HUD"):FindFirstChild("Health")
                if HealthUI and HealthUI.Visible then
                    StatusLabel:Set("Phase: Fighting")
                    
                    if FarmMode == "Alt" then
                        -- Alt mode: Kill self
                        local character = LocalPlayer.Character
                        if character then
                            local humanoid = character:FindFirstChild("Humanoid")
                            if humanoid and humanoid.Health > 0 then
                                humanoid.Health = 0
                                print("[ALT] Killed self")
                            end
                        end
                    else
                        -- Main mode: Just fight normally
                        print("[MAIN] In fight phase")
                        StatusLabel:Set("Phase: Waiting")
                    end
                    wait(0.5)
                end
            end
            
            -- PHASE 6: Idle or unknown
            StatusLabel:Set("Mode: " .. FarmMode .. " | Checking...")
            
        else
            -- Farm disabled
            StatusLabel:Set("Status: Disabled")
        end
        
        -- Fast loop - check every 0.3 seconds
        wait(0.3)
    end
end)

-- Initialize
Rayfield:LoadConfiguration()

-- Notify user
Rayfield:Notify({
    Title = "ABA Auto Farm Loaded",
    Content = "Script loaded successfully!",
    Duration = 5,
    Image = 4483362458,
})

print("[INFO] ABA Auto Farm Script Loaded")
print("[INFO] Select a mode to start farming")
